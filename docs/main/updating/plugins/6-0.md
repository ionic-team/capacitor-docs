---
title: 插件升级至 6.0 指南
description: 将您的插件从早期版本升级到 Capacitor v6 的指南
slug: /updating/plugins/6-0
---

# 代码中的重大变更

## iOS

### 移除 removeAllListeners 方法

如果您的插件在 `.m` 文件中包含 `CAP_PLUGIN_METHOD(removeAllListeners, CAPPluginReturnPromise)`，现在可以将其移除。该方法现已对所有插件可用，无需额外定义。

### 添加 SPM 支持

Capacitor 6 增加了实验性的 SPM 支持，您可以根据[将现有插件转换为 SPM](../../ios/spm.md#converting-existing-plugins-to-spm) 指南为您的插件添加支持。

## definitions.ts

`addListener` 方法的签名已更改为仅返回 `Promise`，请移除 `& PluginListenerHandle`。

```diff
  addListener(
    eventName: 'resume',
    listenerFunc: () => void,
- ): Promise<PluginListenerHandle> & PluginListenerHandle;
+ ): Promise<PluginListenerHandle>;
```

# 将插件中的 Capacitor 升级至 6.0

## 使用 @capacitor/plugin-migration-v5-to-v6

在插件文件夹中，运行 `npx @capacitor/plugin-migration-v5-to-v6@latest`，它将自动执行所有文件更改。

## 手动更新文件

### 更新 package.json

将 `@capacitor/cli`、`@capacitor/core`、`@capacitor/android` 和 `@capacitor/ios` 更新至 `latest-6` 版本。

### 替换已弃用的 compileSdkVersion 并更新 targetSDK / compileSDK 至 34

```diff
# build.gradle

android {
-    compileSdkVersion project.hasProperty('compileSdkVersion') ? rootProject.ext.compileSdkVersion : 33
+    compileSdk project.hasProperty('compileSdkVersion') ? rootProject.ext.compileSdkVersion : 34
-    targetSdkVersion project.hasProperty('targetSdkVersion') ? rootProject.ext.targetSdkVersion : 33
+    targetSdkVersion project.hasProperty('targetSdkVersion') ? rootProject.ext.targetSdkVersion : 34
```

### 更新 Gradle 插件至 8.2.1

```diff
    dependencies {
-       classpath 'com.android.tools.build:gradle:8.0.0'
+       classpath 'com.android.tools.build:gradle:8.2.1'
    }
```

### 更新 Gradle Wrapper 至 8.2.1

```diff
# gradle-wrapper.properties

distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
- distributionUrl=https\://services.gradle.org/distributions/gradle-8.0.2-all.zip
+ distributionUrl=https\://services.gradle.org/distributions/gradle-8.2.1-all.zip
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
```

### 更新 kotlin_version

如果您的插件使用 Kotlin，请更新默认的 `kotlin_version`。

```diff
# build.gradle
buildscript {
-    ext.kotlin_version = project.hasProperty("kotlin_version") ? rootProject.ext.kotlin_version : '1.8.20'
+    ext.kotlin_version = project.hasProperty("kotlin_version") ? rootProject.ext.kotlin_version : '1.9.10'
    repositories {
```